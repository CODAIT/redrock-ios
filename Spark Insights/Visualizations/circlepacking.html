<!DOCTYPE html>
<meta charset="utf-8">
<style>

.node {
  cursor: pointer;
   -webkit-transition: all 0.5s ease-in-out;
  -moz-transition: all 0.5s ease-in-out;
  -o-transition: all 0.5s ease-in-out;
  transition: all 0.5s ease-in-out;
}

.node:hover {
 stroke: rgba(0, 0, 0, 0.48);
  stroke-width: 6.5px;
}

.node--leaf {
  fill: white;
}

.label {
  font: 10px "Helvetica Neue", Helvetica, Arial, sans-serif;
  text-anchor: middle;
  /*text-shadow: 0 1px 0 #fff, 1px 0 0 #fff, -1px 0 0 #fff, 0 -1px 0 #fff;*/
}

.label,
.node--root,
.node--leaf {
  pointer-events: none;
}

</style>
<body>
<script src="d3.min.js" charset="utf-8"></script>
<script>

//d3.select("body").append("p").text("my text");

var margin = 0,
    diameter = 550;
    
    var w = 800, h = 700;

//var color = d3.scale.ordinal().range(["#C0E6FF","#7CC7FF","#5AAAFA","#5596E6","#4178BE","#325C80","#264A60","#1D3649","#152935","#010205"]);

var parentColor = d3.scale.ordinal().range(["1", "2", "3", "4"]);

var color1 = d3.scale.ordinal().range(["#c2e4f8","#86c3ea","#69a4d8","#5e93cd","#4278bc", "#325c80"]);//, "#264a60", "#1c3648", "#142834", "#010205"]);

var color2 = d3.scale.ordinal().range(["#c8df8e","#b4d455","#8ec63e","#59a745","#4b853d", "#2f6632"]);//, "#204d25", "#1d3b1b", "#162815", "#030403"]);

var color3 = d3.scale.ordinal().range(["#b2ded7","#85cfc8","#5cc3b8","#00b39f","#018571", "#006d5d"]);//, "#005448", "#003c32", "#002a21", "#010303"]);

var color4 = d3.scale.ordinal().range(["#e6d1e6","#c7aad1","#a88fc3","#9771b1","#855ca6", "#734098"]);//, "#552f72", "#402255", "#301940", "#040304"]);

function returnColor(parentColor, number){
    
    if(parentColor == "1"){
        //return "#FF0000";
        return color1(number);
    }
    else if(parentColor == "2"){
        //return "#00FF00";
        return color2(number);
    }
    else if(parentColor == "3"){
        //return "#0000FF";
        return color3(number);
    }
    else if(parentColor == "4"){
        //return "#505050";
        return color4(number);
    }
    else{
        return "#FF69B4";
    }
}

var toggle = false;

var pack = d3.layout.pack()
    .padding(8)
    .size([diameter - margin, diameter - margin])
    .value(function(d) { return d.size; })

var svg = d3.select("body").append("svg")
    .attr("width", w)
    .attr("height", h)
    .append("g")
    .attr("transform", "translate(" + ((diameter / 2)+45) + "," + ((diameter / 2)-25) + ")");

//var data = '{"name": " ","children": [{"name": "1","children": [{"name": ":)", "size": 3938},{"name": "happy", "size": 3812},{"name": "birthday", "size": 60999},{"name": "good", "size": 6714},{"name": "cheers", "size": 3812},{"name": "congrats!", "size": 6714},{"name": "sweet!", "size": 2143}]},{"name": "2","children": [{"name": "love", "size": 3534},{"name": "iloveyou", "size": 5731},{"name": "justin", "size": 7840},{"name": "smiling", "size": 5914},{"name": "joy!", "size": 3416}]},{"name": "3","children": [{"name": ":(", "size": 3938},{"name": "sad", "size": 3812},{"name": "sorry", "size": 6714},{"name": "miss", "size": 6714},{"name": "bad", "size": 3812},{"name": "heartbroken", "size": 6714},{"name": "pain", "size": 2243},{"name": "sick", "size": 2443}]}]}'

//var dataAsJSON = JSON.parse(data);

function renderChart(data){

//var blah = '{"name": " ","children": [{"name": "1","children": [{"name": ":)", "size": 3938},{"name": "happy", "size": 3812},{"name": "birthday", "size": 60999},{"name": "good", "size": 6714},{"name": "cheers", "size": 3812},{"name": "congrats!", "size": 6714},{"name": "sweet!", "size": 2143}]},{"name": "2","children": [{"name": "love", "size": 3534},{"name": "iloveyou", "size": 5731},{"name": "justin", "size": 7840},{"name": "smiling", "size": 5914},{"name": "joy!", "size": 3416}]},{"name": "3","children": [{"name": ":(", "size": 3938},{"name": "sad", "size": 3812},{"name": "sorry", "size": 6714},{"name": "miss", "size": 6714},{"name": "bad", "size": 3812},{"name": "heartbroken", "size": 6714},{"name": "pain", "size": 2243},{"name": "sick", "size": 2443}]}]}'

//var root = JSON.parse(blah);

  var root = JSON.parse(data);

  var focus = root,
      nodes = pack.nodes(root),
      view;
      
  svg.selectAll("circle,text").remove()
      
  var circle = svg.selectAll("circle")
      .data(nodes)
    .enter().append("circle")
      .attr("class", function(d) { return d.parent ? d.children ? "node" : "node node--leaf" : "node node--root"; })
      .style("fill", function(d) { if(d.depth>=2){ return d.parent ? returnColor(parentColor(d.parent.name),d.size) : null; }else{return "rgba(0,0,0,0)"}})
      //.on("click", function(d) { if (focus !== d) zoom(d), d3.event.stopPropagation(); });

  var text = svg.selectAll("text")
      .data(nodes)
      .enter();
      
      text.append("text")
      .attr("class", "label")
      //.attr("dy", "-0.2em")
      .attr("dy","0.4em")
      .attr("opacity",(toggle)?0:1)
      .style("text-anchor", "middle")
      .style("fill-opacity", function(d) { return 0.5;})
      //.style("fill", "white")
      .style("display", function(d) { return 1;})
      .style("font-size", function(d){return Math.round(d.r*0.33)+"px"})
      .text(function(d) { if(d.depth>=2){ return (d.name);}else{return " ";} });
      
      /*
      text.append("text")
      .attr("class", "label")
      .attr("dy", "0.75em")
      .style("text-anchor", "middle")
      .attr("opacity",(toggle)?0:1)
      .style("fill-opacity", function(d) { return 0.5;})
      //.style("fill", "white")
      .style("display", function(d) { return 1;d.parent === root ? null : "none"; })
      .style("font-size", function(d){return Math.round(d.r*0.33)+"px"})
      .text(function(d) { if(d.depth>=2){ return (" (" + d.size + ")");}else{return " ";} });*/

  var node = svg.selectAll("circle,text");
  
  node.filter(function(d) { return !d.children;}).append("text")

  d3.select("body")
      .style("background", "#FFF")
      .on("click", function() { zoom(root); });

  zoomTo([root.x, root.y, root.r * 2 + margin]);

  function zoom(d) {
    var focus0 = focus; focus = d;

    var transition = d3.transition()
        .duration(d3.event.altKey ? 7500 : 750)
        .tween("zoom", function(d) {
          var i = d3.interpolateZoom(view, [focus.x, focus.y, focus.r * 2 + margin]);
          return function(t) { zoomTo(i(t)); };
        });

    transition.selectAll("text")
      .filter(function(d) { return d.parent === focus || this.style.display === "inline"; })
        .style("fill-opacity", function(d) { return d.parent === focus ? 1 : 0; })
        .each("start", function(d) { if (d.parent === focus) this.style.display = "inline"; })
        .each("end", function(d) { if (d.parent !== focus) this.style.display = "none"; });

    //Handle on click event
    svg.on("click",function(){
      var coordinates = d3.mouse(this);
      //toggle = !toggle;

      //var text = svg.selectAll("text").attr("opacity",(toggle)?0:1);

    }) 
  }

  function zoomTo(v) {
    var k = diameter / v[2]; view = v;
    node.attr("transform", function(d) { return "translate(" + (d.x - v[0]) * k + "," + (d.y - v[1]) * k + ")"; });
    circle.attr("r", function(d) { return d.r * k; });
  }
};

d3.select(self.frameElement).style("height", diameter + "px");

</script>


<!-- renderChart('{"name": "all","children": [{"name": "ecstatic","children": [{"name": "ecstatic", "size": 222}]},{"name": "glad","children": [{"name": "glad", "size": 344}]},{"name": "bummed","children": [{"name": "bummed", "size": 111}]},{"name": "drunk","children": [{"name": "drunk", "size": 577}]},{"name": "trashed","children": [{"name": "trashed", "size": 99}]},{"name": "lovesick","children": [{"name": "lovesick", "size": 233}]},{"name": "crushing","children": [{"name": "crushing", "size": 333}]},{"name": "cloud9","children": [{"name": "cloud9", "size": 288}]},{"name": "turned-on","children": [{"name": "turned-on", "size": 555}]},{"name": "happy","children": [{"name": "happy", "size": 444}]},{"name": "wasted","children": [{"name": "wasted", "size": 55}]}]}'); -->