<!DOCTYPE html>
<meta charset="utf-8">
<style>

.node {
  cursor: pointer;
   -webkit-transition: all 0.5s ease-in-out;
  -moz-transition: all 0.5s ease-in-out;
  -o-transition: all 0.5s ease-in-out;
  transition: all 0.5s ease-in-out;
}

.node:hover {
  stroke: #AEB8B8;
  stroke-width: 5px;
}

.node--leaf {
  fill: white;
}

.label {
  font: 10px "Helvetica Neue", Helvetica, Arial, sans-serif;
  text-anchor: middle;
  /*text-shadow: 0 1px 0 #fff, 1px 0 0 #fff, -1px 0 0 #fff, 0 -1px 0 #fff;*/
}

.label,
.node--root,
.node--leaf {
  pointer-events: none;
}

</style>
<body>
<script src="d3.min.js" charset="utf-8"></script>
<script>

//d3.select("body").append("p").text("my text");

var margin = 0,
    diameter = 550;

    var w = 800, h = 700;

    var zoomedInSize = 0.88
    var zoomedOutSize = 0.33

//var color = d3.scale.ordinal().range(["#C0E6FF","#7CC7FF","#5AAAFA","#5596E6","#4178BE","#325C80","#264A60","#1D3649","#152935","#010205"]);

var parentColor = d3.scale.ordinal().range(["1", "2", "3", "4", "5", "6", "7", "8"]);

var color1 = d3.scale.ordinal().range(["#c2e4f8","#86c3ea","#69a4d8","#5e93cd","#4278bc", "#325c80"]);//, "#264a60", "#1c3648", "#142834", "#010205"]);

var color2 = d3.scale.ordinal().range(["#c8df8e","#b4d455","#8ec63e","#59a745","#4b853d", "#2f6632"]);//, "#204d25", "#1d3b1b", "#162815", "#030403"]);

var color3 = d3.scale.ordinal().range(["#b2ded7","#85cfc8","#5cc3b8","#00b39f","#018571", "#006d5d"]);//, "#005448", "#003c32", "#002a21", "#010303"]);

var color4 = d3.scale.ordinal().range(["#e6d1e6","#c7aad1","#a88fc3","#9771b1","#855ca6", "#734098"]);//, "#552f72", "#402255", "#301940", "#040304"]);

var color5 = d3.scale.ordinal().range(["#FFD2FF","#FF9EEE","#FF71D4","#FF3CA0","#DB2780", "#A6266E"]);

var color6 = d3.scale.ordinal().range(["#FFD2DD","#FFA5B4","#FF7D87","#FF5050","#E71D32", "#AD1625"]);

var color7 = d3.scale.ordinal().range(["#FFD791","#FFA573","#FF7832","#FF5003","#D74108", "#A53725"]);

var color8 = d3.scale.ordinal().range(["#FDE876","#FDD600","#EFC100","#BE9B00","#8C7300", "#735F00"]);


function returnColor(parentColor, number){

    if(parentColor == "1"){
        return color1(number);
    }
    else if(parentColor == "2"){
        return color2(number);
    }
    else if(parentColor == "3"){
        return color3(number);
    }
    else if(parentColor == "4"){
        return color4(number);
    }
    else if(parentColor == "5"){
        return color5(number);
    }
    else if(parentColor == "6"){
        return color6(number);
    }
    else if(parentColor == "7"){
        return color7(number);
    }
    else if(parentColor == "8"){
        return color8(number);
    }
    else{
        return "#FF69B4";
    }
}

var toggle = false;

var pack = d3.layout.pack()
    .padding(8)
    .size([diameter - margin, diameter - margin])
    .value(function(d) { return d.size; });

var svg = d3.select("body").append("svg")
    .attr("width", w)
    .attr("height", h)
    .append("g")
    .attr("transform", "translate(" + ((diameter / 2)+45) + "," + ((diameter / 2)-25) + ")");

function renderChart(data){

  var root = JSON.parse(data);

  var focus = root,
      nodes = pack.nodes(root),
      view;

  svg.selectAll("circle,text").remove();

  var circle = svg.selectAll("circle")
      .data(nodes)
    .enter().append("circle")
      .attr("class", function(d) { return d.parent ? d.children ? "node" : "node node--leaf" : "node node--root"; })
      .style("fill", function(d) { if(d.depth>=2){ return d.parent ? returnColor(parentColor(d.parent.name),d.size) : null; }else{return "rgba(0,0,0,0)"}})
      .on("click", function(d) { if (focus !== d) zoom(d), d3.event.stopPropagation(), resize(d); });

  var text = svg.selectAll("text")
      .data(nodes)
      .enter();

  var appendedText = text.append("text");
      appendedText.attr("class", "label")
      .attr("dy","0.4em")
      .attr("opacity",(toggle)?0:1)
      .style("text-anchor", "middle")
      .style("fill-opacity", function(d) { return 0.5;})
      .style("display", function(d) { return 1;})
      .style("font-size", function(d){return Math.round(d.r*zoomedOutSize)+"px"})
      .text(function(d) { if(d.depth>=2){ return (d.name);}else{return " ";} });

  var node = svg.selectAll("circle,text");

  node.filter(function(d) { return !d.children;}).append("text");

  d3.select("body")
      .style("background", "#FFF")
      .on("click", function() { zoom(root); });

  zoomTo([root.x, root.y, root.r * 2 + margin]);

  function resize(root){
    var focus0 = focus; focus = root;
    //alert("zooming in click");

    appendedText
    .filter(function(root){return root.parent === focus;})
    .style("font-size", function(d){ return Math.round(d.r*zoomedInSize)+"px";});
  }

  function hideThenShow(){
    appendedText.style("fill-opacity", 0);
    setTimeout(function(){
      appendedText.style("fill-opacity", 0.6);
    }, 0.4*1000);
  }

  function zoom(d) {
    var focus0 = focus; focus = d;

    var transition = d3.transition()
        .duration(d3.event.altKey ? 7500 : 750)
        .tween("zoom", function(d) {
          var i = d3.interpolateZoom(view, [focus.x, focus.y, focus.r * 2.3 + margin]);
          return function(t) { zoomTo(i(t)); };
        });


        hideThenShow();

    //Handle on click event
    svg.on("click",function(){
      var coordinates = d3.mouse(this);
      toggle = !toggle;
      //alert("zooming out click")

      appendedText
      .filter(function(root){return root.parent === focus;})
      .style("font-size", function(d){ return Math.round(d.r*zoomedOutSize)+"px"});

    })
  }

  function zoomTo(v) {
    var k = diameter / v[2]; view = v;
    node.attr("transform", function(d) { return "translate(" + (d.x - v[0]) * k + "," + (d.y - v[1]) * k + ")"; });
    circle.attr("r", function(d) { return d.r * k; });
  }
};

d3.select(self.frameElement).style("height", diameter + "px");

renderChart('{"name": "all","children": [{"name": "ecstatic","children": [{"name": "ecstatic", "size": 222}, {"name": "gleeful", "size": 333}]},{"name": "glad","children": [{"name": "glad", "size": 344}, {"name": "great", "size": 111}, {"name": "awesome", "size": 234}]},{"name": "bummed","children": [{"name": "bummed", "size": 111}]},{"name": "drunk","children": [{"name": "drunk", "size": 577}]},{"name": "trashed","children": [{"name": "trashed", "size": 99}]},{"name": "lovesick","children": [{"name": "lovesick", "size": 233}]},{"name": "crushing","children": [{"name": "crushing", "size": 333}]},{"name": "cloud9","children": [{"name": "cloud9", "size": 288}]},{"name": "turned-on","children": [{"name": "turned-on", "size": 555}]},{"name": "happy","children": [{"name": "happy", "size": 444}]},{"name": "wasted","children": [{"name": "wasted", "size": 55}]}]}');

</script>
