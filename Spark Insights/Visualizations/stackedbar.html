<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <link href="nv.d3.css" rel="stylesheet" type="text/css">
    <script src="d3.min.js" charset="utf-8"></script>
    <script src="nv.d3.js"></script>
    <script src="stream_layers.js"></script>

    <style>
        text {
            font: 12px sans-serif;
        }
        svg {
            display: block;
        }
        html, body, #chart1, svg {
            margin:  0px;
            padding-left: 8px;
            padding-top: 17px;
            height:  96%;
            width:   98%;
        }
    
    .nvd3 .nv-legend .nv-legendWrap{
        transform: translate(0px, 30px);
    }

    </style>
</head>
<body>

<div id="chart1" class='with-3d-shadow with-transitions'>
    <svg></svg>
</div>

<script>

/* //css that can be used to modify axes
.nvd3 .nv-axis.nv-x path.domain{
    stroke-width: 4px;
    stroke-opacity: 1.00;
    stroke: #989898;
    transform: translate(0px,10px);
}
*/


    var chartData = null
    function renderChart(data) {

        chartData = transformData(data);

        nv.addGraph(function() {
            var chart = nv.models.multiBarChart().showControls(false).stacked(true);
            chart.x(function(d,i) {
                    //return d.x
                    return i;
                    });
            chart.y(function(d) {
                    return d.y
                    });
            chart.color(["#325d80","#94d9d1"]);
            chart.margin({left: 100, right:100,top:100,bottom:100});
            chart.tooltips(true);
            chart.reduceXTicks(false);
            chart.xAxis
            .axisLabel("")
            .tickFormat(function(d, i) {
                        return chartData[0].values[d].x;
                        // if(d == 0){
                        //     return d;
                        // }else if( (d.indexOf('Feb 27') >= 0) && (i % 10 != 0) ) {
                        //   return "";
                        // }
                        // else {
                        //   return d;
                        // }
            });
            //chart.xAxis.rotateLabels(-30);
            chart.yAxis
            //.axisLabel("Count")
            .tickFormat(d3.format(',.0d'));

            d3.select('#chart1 svg')
            .datum(chartData)
            .call(chart);

            nv.utils.windowResize(chart.update);

            d3.select('body')
            .selectAll('.nv-x.nv-axis > g')
            .selectAll('g')
            .selectAll('text')
            .attr('transform', function(d) {return 'translate (0,7) rotate(-30 0,0)'});

            //d3.select('body')
            //.selectAll('rect.nv-bar.positive')
            //.attr('transform', function(d) {return 'translate (-33,-33)'});
            //.attr('stroke', 'white')
            //.attr('stroke-width', '12px')
            //.attr('stroke-opacity', 1);

            //chart.selectAll('.axis line, .axis path').style({'stroke': 'Red', 'stroke-width': '20px'});

            return chart;
        });

    }

    //var flareData = '{"name": "all","children": [{"name": "accountant","children": [{"name": "accountant", "size": 3938}]},{"name": "clown","children": [{"name": "clown", "size": 555}]},{"name": "programmer","children": [{"name": "programmer", "size": 6666}]},{"name": "marketer","children": [{"name": "marketer", "size": 4444}]},{"name": "engineer","children": [{"name": "engineer", "size": 5555}]},{"name": "cop","children": [{"name": "cop", "size": 743}]}]}';


    /*
    var myData = [{
      "key": "Tweet Count",
      "values": [
        {"x":"11/17","y":43, "z": 33},
        {"x":"11/18","y":22, "z": 22},
        {"x":"11/19","y":22, "z": 22},
        {"x":"11/20","y":33, "z": 11},
        {"x":"11/21","y":51, "z": 15},
        {"x":"11/22","y":44, "z": 23},
        {"x":"11/23","y":55, "z": 44}
      ]
      }
    ];
    renderChart(myData);
     */

    function transformData(data){
        //Copy Object
        var newData = data;
        newData[0].key = "Positive Sentiment"
        var newObj = clone(data[0]);
        newObj.key = "Negative Sentiment";

        newObj.values = newObj.values.map(function(itm,i,a){
            return {
            x: itm.x,
            y: +itm.z
          };
        });

        newData.push(newObj);
        return newData;
    }

    function clone(obj) {
        if (null == obj || "object" != typeof obj) return obj;
        var copy = obj.constructor();
        for (var attr in obj) {
            if (obj.hasOwnProperty(attr)) copy[attr] = obj[attr];
        }
        return copy;
    }


    </script>
</body>
</html>
