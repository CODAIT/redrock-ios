<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <link href="nv.d3.css" rel="stylesheet" type="text/css">
    <script src="d3.min.js" charset="utf-8"></script>
    <script src="nv.d3.js"></script>
    <script src="stream_layers.js"></script>

    <style>
        text {
            font: 12px sans-serif;
        }
        svg {
            display: block;
        }
        html, body, #chart1, svg {
            margin:  15px;
            padding-top: 5px;
            height:  96%;
            width:   98%;
        }

    </style>
</head>
<body>

<div id="chart1" class='with-3d-shadow with-transitions'>
    <svg></svg>
</div>

<script>

    var chartData = null
    function renderChart(data) {

        chartData = transformData(data);

        nv.addGraph(function() {
            var chart = nv.models.multiBarChart().showControls(false).stacked(true);
            chart.x(function(d,i) {
                    //return d.x
                    return i;
                    });
            chart.y(function(d) {
                    return d.y
                    });
            chart.color(["#94d9d1","#325d80"]); //,"rgba(0,0,0,0)",
            chart.margin({left: 100, right:100,top:100,bottom:100});
            chart.tooltips(true);
            chart.xAxis
            .axisLabel("")
            .tickFormat(function(d, i) {
                        return chartData[0].values[d].x;
                        // if(d == 0){
                        //     return d;
                        // }else if( (d.indexOf('Feb 27') >= 0) && (i % 10 != 0) ) {
                        //   return "";
                        // }
                        // else {
                        //   return d;
                        // }
            });;
            chart.xAxis.rotateLabels(-30);
            chart.yAxis
            //.axisLabel("Count")
            .tickFormat(d3.format(',.0d'));

            d3.select('#chart1 svg')
            .datum(chartData)
            .call(chart);

            nv.utils.windowResize(chart.update);

            return chart;
        });

    }

    //var flareData = '{"name": "all","children": [{"name": "accountant","children": [{"name": "accountant", "size": 3938}]},{"name": "clown","children": [{"name": "clown", "size": 555}]},{"name": "programmer","children": [{"name": "programmer", "size": 6666}]},{"name": "marketer","children": [{"name": "marketer", "size": 4444}]},{"name": "engineer","children": [{"name": "engineer", "size": 5555}]},{"name": "cop","children": [{"name": "cop", "size": 743}]}]}';

    var myData = [{
      "key": "Tweet Count",
      "values": [
        {"x":"dog","y":43, "z": 33},
        {"x":"cat","y":22, "z": 22},
        {"x":"red","y":13, "z": 11},
        {"x":"white","y":44, "z": 23},
        {"x":"blue","y":55, "z": 44}
      ]
      }
    ];
    renderChart(myData);

    function transformData(data){
        //Copy Object
        var newData = data;
        newData[0].key = "Positive Sentiment"
        var newObj = clone(data[0]);
        newObj.key = "Negative Sentiment";

        newObj.values = newObj.values.map(function(itm,i,a){
            return {
            x: itm.x,
            y: +itm.z
          };
        });

        newData.push(newObj);
        return newData;
    }

    function clone(obj) {
        if (null == obj || "object" != typeof obj) return obj;
        var copy = obj.constructor();
        for (var attr in obj) {
            if (obj.hasOwnProperty(attr)) copy[attr] = obj[attr];
        }
        return copy;
    }


    </script>
</body>
</html>
