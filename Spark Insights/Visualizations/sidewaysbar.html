<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
            <link href="nv.d3.css" rel="stylesheet" type="text/css">
                <script src="d3.min.js" charset="utf-8"></script>
                <script src="nv.d3.js"></script>
                <script src="stream_layers.js"></script>
                
                <style>
                    text {
                        font: 12px sans-serif;
                    }
                svg {
                    display: block;
                }
                html, body, #chart1, svg {
                    margin:  0px;
                    padding-left: 8px;
                    padding-top: 17px;
                    height:  96%;
                    width:   98%;
                }
                
                .nvd3 .nv-legend .nv-legendWrap{
                    transform: translate(0px, 30px);
                }
                .nvd3 .nv-axis.nv-x path.domain {
                    stroke-opacity: 1;
                }
                
                .nvd3 .nv-axis path {
                    fill: none;
                    stroke: rgba(0, 0, 0, 0.32);
                    stroke-opacity: .75;
                    shape-rendering: crispEdges;
                }
                
                text{
                    fill: rgb(171, 171, 171);
                    font-weight:normal !important;
                }
                .tick {
                    opacity: 1.0 !important;
                }
                circle {
                    opacity: 0.8;
                }
                </style>
    </head>
    <body>
        
        <div id="chart1" class='with-3d-shadow with-transitions'>
            <svg id="canvas"></svg>
        </div>
        <script>
            
            
            var chartData = null;
            var chart = null;
            var toggle = true;
            function renderChart(data) {
                
                chartData = transformData(data);
                
                nv.addGraph(function() {
                            chart = nv.models.multiBarChart()
                            .showControls(false)
                            .groupSpacing(0.5)
                            .hideable(true)
                            .duration(1000)
                            .showYAxis(true)
                            .showLegend(false)
                            .stacked(true);
                            chart.x(function(d,i) {
                                    //return d.x
                                    return i;
                                    });
                            chart.y(function(d) {
                                    return d.y
                                    });
                            chart.color(["#325d80","#94d9d1"]);
                            chart.margin({left: 80, right:80,top:80,bottom:80});
                            chart.tooltips(true);
                            chart.reduceXTicks(true);
                            chart.xAxis
                            .axisLabel("")
                            .tickFormat(function(d, i) {
                                        return chartData[0].values[d].x.substring(0,chartData[0].values[d].x.length);
                                        });
                            chart.xAxis.rotateLabels(-30);
                            chart.yAxis
                            //.axisLabel("Count")
                            .tickFormat(d3.format(',.0d'));
                            
                            d3.select('#chart1 svg')
                            .datum(chartData)
                            .call(chart);
                            
                            nv.utils.windowResize(chart.update);
                            
                            /*
                            d3.select('body')
                            .selectAll('.nv-x.nv-axis > g')
                            .selectAll('g')
                            .selectAll('text')
                            .attr('transform', function(d) {return 'translate (8,7) rotate(-30 0,0)'});
                             */
                            
                            return chart;
                            },function(){
                            d3.select("#canvas").on('click',
                                                    function(event){
                                                    var coordinates = d3.mouse(this);
                                                    showClickPoint(coordinates);
                                                    //toggle = !toggle;
                                                    //chart.showControls(toggle);
                                                    //chart.showYAxis(toggle);
                                                    //chart.showLegend(toggle);
                                                    chart.update();
                                                    });
                            });
                            
            }
        
        function showClickPoint(cords){
            var svg = d3.select("#canvas");
            svg.append("circle")
            .attr("class", "cursor")
            .attr("r", 0)
            .attr("fill","#43ACD5")
            .attr("transform", "translate(" + cords[0]+","+cords[1] + ")")
            .transition()
            .attr("r", 20)
            .transition()
            .attr("r", 0)
            .remove();
        }
        
        function transformData(data){
            //Copy Object
            var newData = data;
            newData[0].key = "Positive Sentiment"
            var newObj = clone(data[0]);
            newObj.key = "Negative Sentiment";
            
            newObj.values = newObj.values.map(function(itm,i,a){
                                              return {
                                              x: itm.x,
                                              y: +itm.z
                                              };
                                              });
                                              
                                              newData.push(newObj);
                                              return newData;
        }
        
        function clone(obj) {
            if (null == obj || "object" != typeof obj) return obj;
            var copy = obj.constructor();
            for (var attr in obj) {
                if (obj.hasOwnProperty(attr)) copy[attr] = obj[attr];
            }
            return copy;
        }
        
        //renderChart([{"key": "Tweet Count", "values": [{"x": "11/17", "y":43, "z":33},{"x": "11/18", "y":22, "z":22},{"x": "11/19", "y":22, "z":22},{"x": "11/20", "y":22, "z":22},{"x": "11/21", "y":22, "z":22},{"x": "11/22", "y":22, "z":22},{"x": "11/23", "y":22, "z":22}]}]);
        
            </script>
    </body>
</html>